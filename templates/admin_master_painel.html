<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel Admin Master - Licenciamento</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { background: #f4f6fa; }
    .painel-box { max-width: 480px; margin: 40px auto; background: #fff; border-radius: 12px; box-shadow: 0 4px 32px #0001; padding: 2.5rem 2rem; }
    .painel-box h2 { margin-bottom: 1.5rem; }
    .painel-box .form-label { font-weight: 500; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item"><a class="nav-link" href="/admin_master/painel">Licenciamento</a></li>
            <li class="nav-item"><a class="nav-link" href="/admin_master/contato">Personalizar Contato</a></li>
            <li class="nav-item"><a class="nav-link" href="/admin_master/logout">Sair</a></li>
          </ul>
        </div>
      </nav>
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="painel-box">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="mb-0">Licenciamento</h2>
          </div>
          {% if mensagem %}<div class="alert alert-success">{{ mensagem }}</div>{% endif %}
          <form method="post">
            <div class="mb-3">
              <label class="form-label">Tipo de Licença</label>
              <select class="form-select" name="tipo" id="tipoLicenca" onchange="onTipoChange()">
                <option value="indeterminado" {% if licenca.tipo == 'indeterminado' %}selected{% endif %}>Indeterminada</option>
                <option value="data_fixa" {% if licenca.tipo == 'data_fixa' %}selected{% endif %}>Até uma data</option>
                <option value="dias" {% if licenca.tipo == 'dias' %}selected{% endif %}>Por quantidade de dias</option>
              </select>
            </div>
            <div class="mb-3" id="dataFixaBox" style="display:none;">
              <label class="form-label">Data de Expiração</label>
              <input type="date" class="form-control" name="data_expiracao" value="{{ licenca.data_expiracao or '' }}">
            </div>
            <div class="mb-3" id="diasBox" style="display:none;">
              <label class="form-label">Dias Restantes</label>
              <input type="number" class="form-control" name="dias_restantes" min="1" value="{{ licenca.dias_restantes or '' }}">
            </div>
            <div class="d-flex gap-2 mb-3">
              <button class="btn btn-danger" id="btnBloquear">Bloquear Sistema Imediatamente</button>
              <button class="btn btn-success" id="btnDesbloquear">Desbloquear Sistema</button>
            </div>
            <button type="submit" class="btn btn-primary w-100">Salvar Licença</button>
          </form>
          <div class="mt-4">
            <h5>Status Atual:</h5>
            <div class="alert alert-info">Tipo: <b>{{ licenca.tipo }}</b><br>
              {% if licenca.tipo == 'data_fixa' %}Expira em: <b>{{ licenca.data_expiracao }}</b>{% endif %}
              {% if licenca.tipo == 'dias' %}Dias restantes: <b>{{ licenca.dias_restantes }}</b>{% endif %}
              {% if licenca.tipo == 'indeterminado' %}Licença sem expiração definida.{% endif %}
            </div>
            {% if mensagem %}<div class="alert alert-success">{{ mensagem }}</div>{% endif %}
          </div>
        </div>
      </main>
    </div>
  </div>
  <script>
    function onTipoChange() {
      const tipo = document.getElementById('tipoLicenca').value;
      document.getElementById('dataFixaBox').style.display = tipo === 'data_fixa' ? '' : 'none';
      document.getElementById('diasBox').style.display = tipo === 'dias' ? '' : 'none';
    }
    document.addEventListener('DOMContentLoaded', onTipoChange);
    document.getElementById('btnBloquear').onclick = async function() {
      if(confirm('Tem certeza que deseja BLOQUEAR o sistema imediatamente?')) {
        const res = await fetch('/admin_master/bloquear', {method:'POST'});
        const data = await res.json();
        alert(data.message);
        location.reload();
      }
    };
    document.getElementById('btnDesbloquear').onclick = async function() {
      const res = await fetch('/admin_master/desbloquear', {method:'POST'});
      const data = await res.json();
      alert(data.message);
      location.reload();
    };
  </script>
</body>
</html> 